# Donor Communication - Visual Flow & Architecture

## Complete Communication Flow Diagram

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                        DONOR COMMUNICATION FLOW

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  STEP 1: APPROVAL WORKFLOW                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                             â”‚
â”‚                                                                              â”‚
â”‚  Admin/Manager Views "Approval Workflow" Tab                               â”‚
â”‚  â”œâ”€ Sees Pending Appeals                                                   â”‚
â”‚  â”œâ”€ Selects Appeal to Review                                               â”‚
â”‚  â”œâ”€ Views Details & Documents                                              â”‚
â”‚  â””â”€ Clicks "APPROVE APPEAL" Button                                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  STEP 2: APPROVAL FORM                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
â”‚                                                                              â”‚
â”‚  Modal/Dialog Shows:                                                       â”‚
â”‚  â”œâ”€ Approved Amount Input    â† Enter final amount                          â”‚
â”‚  â”œâ”€ Remarks Text Area        â† Enter approval notes                        â”‚
â”‚  â”œâ”€ "Approve" Button         â† Confirms action                             â”‚
â”‚  â””â”€ "Cancel" Button          â† Discards action                             â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  STEP 3: API REQUEST                                                       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                       â”‚
â”‚                                                                              â”‚
â”‚  POST /api/approvals/{appealId}/approve                                    â”‚
â”‚  â”œâ”€ Headers: Authorization: Bearer <JWT_TOKEN>                             â”‚
â”‚  â”œâ”€ Body:                                                                   â”‚
â”‚  â”‚  {                                                                       â”‚
â”‚  â”‚    "approvedAmount": 50000,                                             â”‚
â”‚  â”‚    "remarks": "Approved for implementation"                             â”‚
â”‚  â”‚  }                                                                       â”‚
â”‚  â””â”€ Sent to: http://localhost:5000                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  STEP 4: BACKEND PROCESSING                                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                              â”‚
â”‚                                                                              â”‚
â”‚  ApprovalController.approveAppeal()                                        â”‚
â”‚  â””â”€â†’ AppealServiceImpl.approveAppeal()                                      â”‚
â”‚      â”œâ”€ Update Appeal Entity                                               â”‚
â”‚      â”‚  â”œâ”€ status = APPROVED                                               â”‚
â”‚      â”‚  â”œâ”€ approved_amount = 50000                                         â”‚
â”‚      â”‚  â”œâ”€ approval_remarks = "Approved for implementation"                â”‚
â”‚      â”‚  â”œâ”€ approval_date = NOW()                                           â”‚
â”‚      â”‚  â”œâ”€ approver_id = current_user_id                                   â”‚
â”‚      â”‚  â””â”€ Save to Database                                                â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â””â”€â†’ CommunicationServiceImpl.notifyDonorsOnApproval()                  â”‚
â”‚          â”œâ”€ 1. Fetch Donors                                                â”‚
â”‚          â”‚   â””â”€ DonorRepository.findByAppealId(appealId)                   â”‚
â”‚          â”‚      â†’ Get all active donors linked to appeal                   â”‚
â”‚          â”‚                                                                  â”‚
â”‚          â”œâ”€ 2. Build Email Content                                         â”‚
â”‚          â”‚   â””â”€ buildApprovalEmailContent()                                â”‚
â”‚          â”‚      â†’ HTML Email with:                                         â”‚
â”‚          â”‚        â€¢ Appeal title & description                             â”‚
â”‚          â”‚        â€¢ Approved amount                                        â”‚
â”‚          â”‚        â€¢ Next steps                                             â”‚
â”‚          â”‚        â€¢ Professional formatting                                â”‚
â”‚          â”‚                                                                  â”‚
â”‚          â”œâ”€ 3. Send Emails                                                 â”‚
â”‚          â”‚   â””â”€ sendEmailNotifications()                                   â”‚
â”‚          â”‚      â†’ JavaMailSender.send() for each donor                     â”‚
â”‚          â”‚      â†’ Log result (SENT/FAILED)                                 â”‚
â”‚          â”‚      â†’ Handle exceptions gracefully                             â”‚
â”‚          â”‚                                                                  â”‚
â”‚          â”œâ”€ 4. Queue WhatsApp                                              â”‚
â”‚          â”‚   â””â”€ sendWhatsAppNotifications()                                â”‚
â”‚          â”‚      â†’ Build WhatsApp message                                   â”‚
â”‚          â”‚      â†’ Log status as PENDING                                    â”‚
â”‚          â”‚      â†’ Ready for Twilio integration                             â”‚
â”‚          â”‚                                                                  â”‚
â”‚          â””â”€ 5. Log in History                                              â”‚
â”‚              â””â”€ CommunicationHistoryRepository.save()                      â”‚
â”‚                 â†’ Create entry with:                                       â”‚
â”‚                   â€¢ appeal_id                                              â”‚
â”‚                   â€¢ trigger_type = APPROVAL                                â”‚
â”‚                   â€¢ channel = EMAIL/WHATSAPP                               â”‚
â”‚                   â€¢ recipient_count = #donors                              â”‚
â”‚                   â€¢ status = SENT/PENDING/FAILED                           â”‚
â”‚                   â€¢ sent_date = NOW()                                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  STEP 5: EXTERNAL SERVICES                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                â”‚
â”‚                                                                              â”‚
â”‚  Google SMTP (Gmail)                                                       â”‚
â”‚  â”œâ”€ Receives email from JavaMailSender                                     â”‚
â”‚  â”œâ”€ Validates SMTP credentials                                            â”‚
â”‚  â”œâ”€ Sends to donor email addresses                                         â”‚
â”‚  â”œâ”€ Returns delivery status                                                â”‚
â”‚  â””â”€ Logs in sent folder                                                    â”‚
â”‚                                                                              â”‚
â”‚  Donor's Email Client                                                      â”‚
â”‚  â”œâ”€ Receives email                                                         â”‚
â”‚  â”œâ”€ Displays in inbox                                                      â”‚
â”‚  â””â”€ Donor sees approval notification                                       â”‚
â”‚                                                                              â”‚
â”‚  Database (MySQL)                                                          â”‚
â”‚  â”œâ”€ Updates appeals table                                                  â”‚
â”‚  â”œâ”€ Inserts communication_history record                                   â”‚
â”‚  â””â”€ Records metadata for audit trail                                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  STEP 6: API RESPONSE                                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                       â”‚
â”‚                                                                              â”‚
â”‚  HTTP 200 OK                                                               â”‚
â”‚  {                                                                          â”‚
â”‚    "id": 5,                                                                â”‚
â”‚    "title": "Education Support Program",                                   â”‚
â”‚    "status": "APPROVED",                                                   â”‚
â”‚    "approvedAmount": 50000,                                                â”‚
â”‚    "approvalRemarks": "Approved for implementation",                        â”‚
â”‚    "approvalDate": "2024-12-27T10:30:00",                                  â”‚
â”‚    "approverId": 2                                                         â”‚
â”‚  }                                                                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  STEP 7: FRONTEND UPDATE                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                    â”‚
â”‚                                                                              â”‚
â”‚  ApprovalWorkflow Component                                                â”‚
â”‚  â”œâ”€ Receives success response                                              â”‚
â”‚  â”œâ”€ Shows success toast/notification                                       â”‚
â”‚  â”œâ”€ Updates UI (appeal moves from pending)                                 â”‚
â”‚  â””â”€ Auto-refreshes pending appeals list                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  STEP 8: VIEW COMMUNICATION HISTORY                                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                         â”‚
â”‚                                                                              â”‚
â”‚  User Navigates to: Donor Communication â†’ Auto-Triggered Tab               â”‚
â”‚  â”œâ”€ Frontend calls: GET /api/approvals/communications/auto-triggered       â”‚
â”‚  â”œâ”€ Backend queries: CommunicationHistory table                            â”‚
â”‚  â”œâ”€ Returns:                                                               â”‚
â”‚  â”‚  {                                                                      â”‚
â”‚  â”‚    "id": 1,                                                             â”‚
â”‚  â”‚    "appealId": 5,                                                       â”‚
â”‚  â”‚    "triggerType": "approval",                                           â”‚
â”‚  â”‚    "channel": "EMAIL",                                                  â”‚
â”‚  â”‚    "recipientCount": 45,                                                â”‚
â”‚  â”‚    "status": "sent",                                                    â”‚
â”‚  â”‚    "sentDate": "2024-12-27T10:30:00"                                    â”‚
â”‚  â”‚  }                                                                      â”‚
â”‚  â””â”€ Frontend displays in Communication History table                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                               â”‚
â”‚                            FRONTEND LAYER                                    â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ React Components                                                     â”‚    â”‚
â”‚  â”‚ â”œâ”€ ApprovalWorkflow.tsx                                             â”‚    â”‚
â”‚  â”‚ â”‚  â”œâ”€ Displays pending appeals list                               â”‚    â”‚
â”‚  â”‚ â”‚  â”œâ”€ Handles approval button click                               â”‚    â”‚
â”‚  â”‚ â”‚  â”œâ”€ Shows approval modal                                        â”‚    â”‚
â”‚  â”‚ â”‚  â””â”€ Sends POST /api/approvals/{id}/approve                      â”‚    â”‚
â”‚  â”‚ â”‚                                                                  â”‚    â”‚
â”‚  â”‚ â””â”€ DonorCommunication.tsx                                           â”‚    â”‚
â”‚  â”‚    â”œâ”€ Compose Message Tab                                         â”‚    â”‚
â”‚  â”‚    â”‚  â”œâ”€ Fetch appeals from backend                               â”‚    â”‚
â”‚  â”‚    â”‚  â”œâ”€ Select appeal & channel                                  â”‚    â”‚
â”‚  â”‚    â”‚  â”œâ”€ Compose message                                          â”‚    â”‚
â”‚  â”‚    â”‚  â””â”€ Send communication                                       â”‚    â”‚
â”‚  â”‚    â”‚                                                               â”‚    â”‚
â”‚  â”‚    â””â”€ Auto-Triggered Tab                                          â”‚    â”‚
â”‚  â”‚       â”œâ”€ Fetch auto-triggered communications                      â”‚    â”‚
â”‚  â”‚       â”œâ”€ Display communication history                            â”‚    â”‚
â”‚  â”‚       â””â”€ Show status badges (SENT/PENDING/FAILED)                â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
                           (REST API Calls)
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                               â”‚
â”‚                            BACKEND API LAYER                                 â”‚
â”‚                         (Spring Boot - Port 5000)                            â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Controllers (REST Endpoints)                                         â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ ApprovalController                                                  â”‚    â”‚
â”‚  â”‚ â”œâ”€ POST /api/approvals/{id}/approve                                â”‚    â”‚
â”‚  â”‚ â”œâ”€ POST /api/approvals/{id}/reject                                 â”‚    â”‚
â”‚  â”‚ â”œâ”€ GET /api/approvals/communications/auto-triggered                â”‚    â”‚
â”‚  â”‚ â””â”€ GET /api/approvals/communications/auto-triggered/appeal/{id}    â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ AppealController                                                    â”‚    â”‚
â”‚  â”‚ â”œâ”€ POST /api/appeals                                               â”‚    â”‚
â”‚  â”‚ â”œâ”€ GET /api/appeals                                                â”‚    â”‚
â”‚  â”‚ â””â”€ GET /api/appeals/{id}                                           â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ AuthController                                                      â”‚    â”‚
â”‚  â”‚ â”œâ”€ POST /api/auth/login                                            â”‚    â”‚
â”‚  â”‚ â””â”€ GET /api/auth/me                                                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Service Layer (Business Logic)                                       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ AppealServiceImpl                                                    â”‚    â”‚
â”‚  â”‚ â”œâ”€ createAppeal()                                                   â”‚    â”‚
â”‚  â”‚ â”œâ”€ approveAppeal()     â†â”€â”€ Calls CommunicationService              â”‚    â”‚
â”‚  â”‚ â”œâ”€ rejectAppeal()      â†â”€â”€ Calls CommunicationService              â”‚    â”‚
â”‚  â”‚ â””â”€ getAppealById()                                                  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ CommunicationServiceImpl â­ KEY SERVICE                             â”‚    â”‚
â”‚  â”‚ â”œâ”€ notifyDonorsOnApproval()                                         â”‚    â”‚
â”‚  â”‚ â”‚  â”œâ”€ Fetch donors from DonorRepository                            â”‚    â”‚
â”‚  â”‚ â”‚  â”œâ”€ Build HTML email content                                     â”‚    â”‚
â”‚  â”‚ â”‚  â”œâ”€ Send emails via JavaMailSender                               â”‚    â”‚
â”‚  â”‚ â”‚  â”œâ”€ Queue WhatsApp messages                                      â”‚    â”‚
â”‚  â”‚ â”‚  â””â”€ Log in CommunicationHistoryRepository                        â”‚    â”‚
â”‚  â”‚ â”‚                                                                   â”‚    â”‚
â”‚  â”‚ â”œâ”€ notifyDonorsOnRejection()                                        â”‚    â”‚
â”‚  â”‚ â”‚  â”œâ”€ Build rejection email                                        â”‚    â”‚
â”‚  â”‚ â”‚  â”œâ”€ Send emails                                                  â”‚    â”‚
â”‚  â”‚ â”‚  â””â”€ Log in history                                               â”‚    â”‚
â”‚  â”‚ â”‚                                                                   â”‚    â”‚
â”‚  â”‚ â””â”€ getAutoTriggeredCommunications()                                 â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ UserServiceImpl                                                      â”‚    â”‚
â”‚  â”‚ â”œâ”€ createUser()                                                     â”‚    â”‚
â”‚  â”‚ â”œâ”€ getAllUsers()                                                    â”‚    â”‚
â”‚  â”‚ â””â”€ updateUserRole()                                                 â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Repository Layer (Data Access)                                       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ AppealRepository                                                    â”‚    â”‚
â”‚  â”‚ â”œâ”€ findById(id)                                                     â”‚    â”‚
â”‚  â”‚ â”œâ”€ save(appeal)                                                     â”‚    â”‚
â”‚  â”‚ â”œâ”€ findByStatus(status)                                             â”‚    â”‚
â”‚  â”‚ â””â”€ findByCreatedBy_Id(userId)                                       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ DonorRepository â­                                                  â”‚    â”‚
â”‚  â”‚ â”œâ”€ findByAppealId(appealId)  â† Finds all donors for appeal         â”‚    â”‚
â”‚  â”‚ â”œâ”€ findByEmail(email)                                               â”‚    â”‚
â”‚  â”‚ â””â”€ findByIsActiveTrue()                                             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ CommunicationHistoryRepository â­                                   â”‚    â”‚
â”‚  â”‚ â”œâ”€ save(history)     â† Logs communication                          â”‚    â”‚
â”‚  â”‚ â”œâ”€ findAll()                                                        â”‚    â”‚
â”‚  â”‚ â”œâ”€ findByAppealId(appealId)                                         â”‚    â”‚
â”‚  â”‚ â””â”€ findByAppealIdAndTriggerType(appealId, trigger)                 â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ UserRepository                                                      â”‚    â”‚
â”‚  â”‚ â”œâ”€ findByEmail(email)                                               â”‚    â”‚
â”‚  â”‚ â””â”€ findById(id)                                                     â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                               â”‚
â”‚                         DATABASE LAYER (MySQL)                               â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Tables                                                               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ appeals â­                                                          â”‚    â”‚
â”‚  â”‚ â”œâ”€ id                                                              â”‚    â”‚
â”‚  â”‚ â”œâ”€ title, description                                             â”‚    â”‚
â”‚  â”‚ â”œâ”€ status (PENDING, APPROVED, REJECTED, etc.)                     â”‚    â”‚
â”‚  â”‚ â”œâ”€ approved_amount  â† Set when approved                           â”‚    â”‚
â”‚  â”‚ â”œâ”€ approval_date    â† Set when approved/rejected                  â”‚    â”‚
â”‚  â”‚ â”œâ”€ approval_remarks â† Approval/rejection reason                   â”‚    â”‚
â”‚  â”‚ â”œâ”€ approver_id      â† Who approved it                             â”‚    â”‚
â”‚  â”‚ â””â”€ created_by_id                                                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ donors â­                                                          â”‚    â”‚
â”‚  â”‚ â”œâ”€ id                                                              â”‚    â”‚
â”‚  â”‚ â”œâ”€ name, email, phone_number                                      â”‚    â”‚
â”‚  â”‚ â””â”€ is_active                                                       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ donor_appeals (Junction Table) â­                                  â”‚    â”‚
â”‚  â”‚ â”œâ”€ id                                                              â”‚    â”‚
â”‚  â”‚ â”œâ”€ donor_id      â† Links donor to appeal                          â”‚    â”‚
â”‚  â”‚ â”œâ”€ appeal_id     â† Links appeal to donor                          â”‚    â”‚
â”‚  â”‚ â””â”€ donation_amount, donation_date                                  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ communication_history â­ KEY TABLE                                 â”‚    â”‚
â”‚  â”‚ â”œâ”€ id                                                              â”‚    â”‚
â”‚  â”‚ â”œâ”€ appeal_id                                                       â”‚    â”‚
â”‚  â”‚ â”œâ”€ trigger_type (APPROVAL, REJECTION, STATUS_UPDATE)             â”‚    â”‚
â”‚  â”‚ â”œâ”€ channel (EMAIL, WHATSAPP, POSTAL_MAIL)                        â”‚    â”‚
â”‚  â”‚ â”œâ”€ recipient_count                                                 â”‚    â”‚
â”‚  â”‚ â”œâ”€ status (SENT, PENDING, FAILED)                                â”‚    â”‚
â”‚  â”‚ â”œâ”€ sent_by_user_id                                                 â”‚    â”‚
â”‚  â”‚ â”œâ”€ sent_date                                                       â”‚    â”‚
â”‚  â”‚ â””â”€ created_at, updated_at                                          â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ users                                                              â”‚    â”‚
â”‚  â”‚ â”œâ”€ id                                                              â”‚    â”‚
â”‚  â”‚ â”œâ”€ email                                                           â”‚    â”‚
â”‚  â”‚ â”œâ”€ password                                                        â”‚    â”‚
â”‚  â”‚ â”œâ”€ role (SUPER_ADMIN, ITC_ADMIN, MISSION_ADMIN, etc.)           â”‚    â”‚
â”‚  â”‚ â””â”€ active                                                          â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                               â”‚
â”‚  ğŸ“Š Key Indexes:                                                            â”‚
â”‚  â”œâ”€ communication_history (appeal_id, trigger_type)                        â”‚    â”‚
â”‚  â”œâ”€ communication_history (status)                                         â”‚    â”‚
â”‚  â”œâ”€ donors (email)                                                         â”‚    â”‚
â”‚  â””â”€ donors (is_active)                                                     â”‚    â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                               â”‚
â”‚                       EXTERNAL SERVICES                                      â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Google SMTP     â”‚  â”‚  Twilio (Optional) â”‚ â”‚  Donor Mailboxes â”‚          â”‚
â”‚  â”‚  (Gmail Server)  â”‚  â”‚  (WhatsApp API)   â”‚  â”‚  (Inbox)         â”‚          â”‚
â”‚  â”‚                  â”‚  â”‚                    â”‚  â”‚                  â”‚          â”‚
â”‚  â”‚  Receives:       â”‚  â”‚  Receives:         â”‚  â”‚  Receives:       â”‚          â”‚
â”‚  â”‚  - Email subject â”‚  â”‚  - WhatsApp msg    â”‚  â”‚  - Email with    â”‚          â”‚
â”‚  â”‚  - Email body    â”‚  â”‚  - Phone number    â”‚  â”‚    approval info â”‚          â”‚
â”‚  â”‚  - Recipients    â”‚  â”‚  - Message text    â”‚  â”‚  - Shows in      â”‚          â”‚
â”‚  â”‚                  â”‚  â”‚                    â”‚  â”‚    inbox         â”‚          â”‚
â”‚  â”‚  Sends to:       â”‚  â”‚  Sends to:         â”‚  â”‚                  â”‚          â”‚
â”‚  â”‚  - Donor emails  â”‚  â”‚  - Donor phones    â”‚  â”‚  Donor sees:     â”‚          â”‚
â”‚  â”‚                  â”‚  â”‚                    â”‚  â”‚  - Approval âœ“    â”‚          â”‚
â”‚  â”‚  Status:         â”‚  â”‚  Status:           â”‚  â”‚  - Amount        â”‚          â”‚
â”‚  â”‚  SENT âœ“          â”‚  â”‚  PENDING â³        â”‚  â”‚  - Next steps    â”‚          â”‚
â”‚  â”‚                  â”‚  â”‚                    â”‚  â”‚                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Database Schema Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      appeals        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)             â”‚
â”‚ title               â”‚
â”‚ description         â”‚
â”‚ estimated_amount    â”‚
â”‚ approved_amount â­  â”‚
â”‚ beneficiary_categoryâ”‚
â”‚ duration            â”‚
â”‚ status              â”‚
â”‚ created_by_id (FK)  â”‚
â”‚ approver_id (FK) â­ â”‚
â”‚ approval_date â­    â”‚
â”‚ approval_remarks â­ â”‚
â”‚ created_at          â”‚
â”‚ updated_at          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ (1:N)
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                 â”‚
           â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                    â”‚  communication_history â”‚
           â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚                    â”‚ id (PK)                â”‚
           â”‚                    â”‚ appeal_id (FK) â­      â”‚
           â”‚                    â”‚ trigger_type â­        â”‚
           â”‚                    â”‚ channel â­             â”‚
           â”‚                    â”‚ recipient_count        â”‚
           â”‚                    â”‚ content (LONGTEXT)     â”‚
           â”‚                    â”‚ status â­              â”‚
           â”‚                    â”‚ sent_by_user_id        â”‚
           â”‚                    â”‚ sent_date              â”‚
           â”‚                    â”‚ error_message          â”‚
           â”‚                    â”‚ created_at             â”‚
           â”‚                    â”‚ updated_at             â”‚
           â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                 â”‚
           â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                    â”‚   donor_appeals        â”‚
           â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚                    â”‚ id (PK)                â”‚
           â”‚                    â”‚ appeal_id (FK) â­â­    â”‚
           â”‚                    â”‚ donor_id (FK) â­â­     â”‚
           â”‚                    â”‚ donation_amount        â”‚
           â”‚                    â”‚ donation_date          â”‚
           â”‚                    â”‚ created_at             â”‚
           â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                            â”‚
           â”‚                            â”‚ (M:1)
           â”‚                            â”‚
           â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                â”‚      donors â­â­      â”‚
           â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚                â”‚ id (PK)              â”‚
           â”‚                â”‚ name                 â”‚
           â”‚                â”‚ email â­             â”‚
           â”‚                â”‚ phone_number â­      â”‚
           â”‚                â”‚ organization         â”‚
           â”‚                â”‚ is_active â­         â”‚
           â”‚                â”‚ created_at           â”‚
           â”‚                â”‚ updated_at           â”‚
           â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚       users          â”‚
                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                â”‚ id (PK)              â”‚
                                â”‚ name                 â”‚
                                â”‚ email                â”‚
                                â”‚ password             â”‚
                                â”‚ role                 â”‚
                                â”‚ active               â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend:
â­   = Key fields for donor communication
â­â­  = Used to link donors to appeals
(FK) = Foreign Key
(PK) = Primary Key
```

---

## Communication Status Flow

```
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   Appeal Approved/Rejected         â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  CommunicationService triggered       â”‚
          â”‚  notifyDonorsOnApproval() /            â”‚
          â”‚  notifyDonorsOnRejection()             â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Fetch Donors for Appeal                     â”‚
        â”‚  DonorRepository.findByAppealId(appealId)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  For Each Donor: Send Email                    â”‚
       â”‚  JavaMailSender.send(message)                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                      â”‚
        Success â—„â”€â”€â”˜                      â”œâ”€â”€â–º Failure
           â†“                              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Email Sent âœ“ â”‚             â”‚  Email Failed âœ—  â”‚
    â”‚ Status: SENT â”‚             â”‚  Status: FAILED  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                              â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Log in CommunicationHistory  â”‚
                â”‚ â”œâ”€ appeal_id                 â”‚
                â”‚ â”œâ”€ trigger_type: APPROVAL    â”‚
                â”‚ â”œâ”€ channel: EMAIL            â”‚
                â”‚ â”œâ”€ recipient_count: N        â”‚
                â”‚ â”œâ”€ status: SENT/FAILED       â”‚
                â”‚ â”œâ”€ sent_date: NOW()          â”‚
                â”‚ â””â”€ created_at: NOW()         â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Frontend Displays in          â”‚
                â”‚ DonorCommunication Tab:       â”‚
                â”‚ Auto-Triggered               â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Version:** 1.0  
**Last Updated:** 2026-01-30
